<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GitHub Pages URL Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .url-test {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      font-family: monospace;
    }
    
    .test-button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px;
    }
    
    .test-button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>GitHub Pages URL Structure Test</h1>
    <p>This page simulates the GitHub Pages environment to test URL generation.</p>
    
    <div class="url-test">
      <h3>Current Environment:</h3>
      <p id="current-env"></p>
      
      <h3>Current URL:</h3>
      <p id="current-url"></p>
      
        <h3>Generated URLs:</h3>
      <p><strong>Bubble Chart (page=bubblechart):</strong> <span id="bubble-url"></span></p>
      <p><strong>Line Chart (page=linechart):</strong> <span id="line-url"></span></p>
    </div>
    
    <div>
      <h3>Test URL Generation:</h3>
  <button class="test-button" onclick="testBubbleChart()">Test Bubble Chart URL</button>
  <button class="test-button" onclick="testLineChart()">Test Line Chart URL</button>
    </div>
    
    <div id="results"></div>
  </div>

  <script>
    // Copy the same functions from index.html for testing
    function normalizeChartId(chartId) {
      if (!chartId) {
        return 'bubblechart';
      }
      const mapping = {
        '1': 'bubblechart',
        'bubble': 'bubblechart',
        'bubblechart': 'bubblechart',
        '2': 'linechart',
        'line': 'linechart',
        'linechart': 'linechart'
      };
      const lower = String(chartId).toLowerCase();
      return mapping[lower] || lower;
    }

    function getDefaultUrl(chartId) {
      // Handle both local and GitHub Pages URLs
      let baseUrl = window.location.pathname;
      if (!baseUrl.endsWith('/')) {
        baseUrl += '/';
      }

      const isGitHubPages = window.location.hostname.includes('github.io');
      if (isGitHubPages && !baseUrl.includes('CIC-test-uk-air-pollution-emissions-data-explorer')) {
        baseUrl = '/CIC-test-uk-air-pollution-emissions-data-explorer/';
      }

      const normalizedId = normalizeChartId(chartId);

      if (normalizedId === 'bubblechart') {
        // Bubble chart defaults: PM2.5 (id=5), Ecodesign Stove + Gas Boilers (ids 20,37), most recent year (2023)
        return `${baseUrl}?page=bubblechart&pollutant_id=5&category_ids=20,37&year=2023`;
      }
      if (normalizedId === 'linechart') {
        // Line chart defaults: PM2.5 (id=5), All category (id=1), full history
        return `${baseUrl}?page=linechart&pollutant_id=5&category_ids=1&start_year=1970&end_year=2023`;
      }

      return `${baseUrl}?page=bubblechart`;
    }

    function getRedirectUrl(chartId) {
      return getDefaultUrl(chartId);
    }

    // Display current environment info
    document.addEventListener('DOMContentLoaded', function() {
      const isGitHubPages = window.location.hostname.includes('github.io');
      const isLocal = window.location.hostname === 'localhost';
      
      document.getElementById('current-env').textContent = 
        isGitHubPages ? 'GitHub Pages' : 
        isLocal ? 'Local Development' : 'Other';
      
      document.getElementById('current-url').textContent = window.location.href;
      document.getElementById('bubble-url').textContent = getDefaultUrl('bubblechart');
      document.getElementById('line-url').textContent = getRedirectUrl('linechart');
    });

    function testBubbleChart() {
      const url = getDefaultUrl('bubblechart');
      showResult('Bubble Chart URL', url);
    }

    function testLineChart() {
      const url = getRedirectUrl('linechart');
      showResult('Line Chart URL', url);
    }

    function showResult(type, url) {
      const results = document.getElementById('results');
      results.innerHTML = `
        <div class="url-test">
          <h3>${type} Result:</h3>
          <p><strong>Generated URL:</strong> ${url}</p>
          <p><a href="${url}" target="_blank">Test this URL</a></p>
        </div>
      `;
    }
  </script>
</body>
</html>