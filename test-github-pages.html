<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GitHub Pages URL Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .url-test {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      font-family: monospace;
    }
    
    .test-button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px 5px;
    }
    
    .test-button:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>GitHub Pages URL Structure Test</h1>
    <p>This page simulates the GitHub Pages environment to test URL generation.</p>
    
    <div class="url-test">
      <h3>Current Environment:</h3>
      <p id="current-env"></p>
      
      <h3>Current URL:</h3>
      <p id="current-url"></p>
      
      <h3>Generated URLs:</h3>
      <p><strong>Default (chart=1):</strong> <span id="default-url"></span></p>
      <p><strong>Line Chart:</strong> <span id="line-url"></span></p>
      <p><strong>Scatter Chart:</strong> <span id="scatter-url"></span></p>
    </div>
    
    <div>
      <h3>Test URL Generation:</h3>
      <button class="test-button" onclick="testDefault()">Test Default URL</button>
      <button class="test-button" onclick="testLineChart()">Test Line Chart URL</button>
      <button class="test-button" onclick="testScatterChart()">Test Scatter Chart URL</button>
    </div>
    
    <div id="results"></div>
  </div>

  <script>
    // Copy the same functions from index.html for testing
    function getDefaultUrl(chartId) {
      // Handle both local and GitHub Pages URLs
      let baseUrl = window.location.pathname;
      if (!baseUrl.endsWith('/')) {
        baseUrl += '/';
      }
      
      if (chartId === '1' || !chartId) {
        // Line chart defaults: PM2.5 (id=5), All group (id=1), 1970-2023
        return `${baseUrl}?chart=1&pollutant_id=5&group_ids=1&start_year=1970&end_year=2023`;
      } else if (chartId === '2') {
        // Scatter chart defaults: PM2.5 (id=5), Ecodesign+Gas groups, most recent year (2023)
        return `${baseUrl}?chart=2&pollutant_id=5&group_names=Ecodesign Stove - RtB,Gas Boilers&year=2023`;
      }
      
      return baseUrl;
    }

    function getRedirectUrl(chartId) {
      // URLs should stay on the same page with chart parameter
      let baseUrl = window.location.pathname;
      if (!baseUrl.endsWith('/')) {
        baseUrl += '/';
      }
      
      return `${baseUrl}?chart=${chartId}&pollutant_id=5&group_ids=${chartId === '1' ? '1' : ''}&group_names=${chartId === '2' ? 'Ecodesign Stove - RtB,Gas Boilers' : ''}&${chartId === '1' ? 'start_year=1970&end_year=2023' : 'year=2023'}`;
    }

    // Display current environment info
    document.addEventListener('DOMContentLoaded', function() {
      const isGitHubPages = window.location.hostname.includes('github.io');
      const isLocal = window.location.hostname === 'localhost';
      
      document.getElementById('current-env').textContent = 
        isGitHubPages ? 'GitHub Pages' : 
        isLocal ? 'Local Development' : 'Other';
      
      document.getElementById('current-url').textContent = window.location.href;
      document.getElementById('default-url').textContent = getDefaultUrl('1');
      document.getElementById('line-url').textContent = getRedirectUrl('1');
      document.getElementById('scatter-url').textContent = getRedirectUrl('2');
    });

    function testDefault() {
      const url = getDefaultUrl('1');
      showResult('Default URL', url);
    }

    function testLineChart() {
      const url = getRedirectUrl('1');
      showResult('Line Chart Redirect', url);
    }

    function testScatterChart() {
      const url = getRedirectUrl('2');
      showResult('Scatter Chart Redirect', url);
    }

    function showResult(type, url) {
      const results = document.getElementById('results');
      results.innerHTML = `
        <div class="url-test">
          <h3>${type} Result:</h3>
          <p><strong>Generated URL:</strong> ${url}</p>
          <p><a href="${url}" target="_blank">Test this URL</a></p>
        </div>
      `;
    }
  </script>
</body>
</html>