<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NAEI Multi-Group Pollutant Viewer</title>
  <link rel="icon" type="image/png" sizes="64x64" href="favicon.png">
  <link rel="apple-touch-icon" href="favicon.png">

  <!-- Social preview / link preview meta tags -->
  <meta name="description" content="NAEI Multi-Group Pollutant Viewer">
  <!-- Open Graph (Facebook, LinkedIn, Slack, etc.) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="NAEI Multi-Group Pollutant Viewer">
  <meta property="og:description" content="Compare emissions from grouped NAEI sources across years. Interactive charts, CSV/XLSX export and downloadable images.">
  <meta property="og:url" content="https://github.com/Chronic-Illness-Channel/naei-multigroup-viewer">
  <meta property="og:image" content="https://raw.githubusercontent.com/Chronic-Illness-Channel/naei-multigroup-viewer/4edd238fc210f2019c4d6b9101bee18172148270/CIC%20-%20NAEI%20Multi-Group%20Viewer%20Thumbnail.1120x630.png">
  <meta property="og:image:width" content="1120">
  <meta property="og:image:height" content="630">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="NAEI Multi-Group Pollutant Viewer">
  <meta name="twitter:description" content="Compare emissions from grouped NAEI sources across years.">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/Chronic-Illness-Channel/naei-multigroup-viewer/4edd238fc210f2019c4d6b9101bee18172148270/CIC%20-%20NAEI%20Multi-Group%20Viewer%20Thumbnail.1120x630.png">
  <meta name="twitter:site" content="@Chronic_Channel">
  <meta name="twitter:creator" content="@Chronic_Channel">
  <!-- Legacy image hint -->
  <link rel="image_src" href="https://raw.githubusercontent.com/Chronic-Illness-Channel/naei-multigroup-viewer/4edd238fc210f2019c4d6b9101bee18172148270/CIC%20-%20NAEI%20Multi-Group%20Viewer%20Thumbnail.1120x630.png">

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>

<body>
  <div id="loadingOverlay">
    <div class="spinner" aria-hidden="true"></div>
    <div class="loading-text">Loading data, please waitâ€¦</div>
  </div>

  <div id="mainContent" aria-hidden="true">
    <div id="mainContentTop">
      <div class="title-row">
        <div class="sidebar-socials">
          <a href="https://www.youtube.com/@ChronicIllnessChannel" target="_blank" rel="noopener" style="cursor:pointer;">
            <img id="cicLogo" src="CIC - Square - Border - Words - Alpha 360x360.png" alt="CIC Logo">
          </a>
          <div class="sidebar-icons">
            <a href="https://youtube.com/@ChronicIllnessChannel" class="sidebar-link" target="_blank" rel="noopener">
              <img src="youtube-logo-6.svg" alt="YouTube">
            </a>
            <a href="https://bsky.app/profile/chronicchannel.bsky.social" class="sidebar-link" target="_blank" rel="noopener">
              <img src="Bluesky_Logo.svg" alt="Bluesky">
            </a>
            <a href="https://twitter.com/@Chronic_Channel" class="sidebar-link" target="_blank" rel="noopener">
              <img src="Twitter dead bird with X.svg" alt="Twitter/X">
            </a>
            <a href="https://facebook.com/ChronicIllnessChannel" class="sidebar-link" target="_blank" rel="noopener">
              <img src="facebook.svg" alt="Facebook">
            </a>
            <a href="https://ko-fi.com/F2F21NGXA3" class="kofi-button" target="_blank" rel="noopener">
              <span class="kofi-text">Support Chronic Illness Channel</span>
              <span class="kofi-icon-svg">
                <svg viewBox="0 0 24 24" style="width: 28px; height: 28px; fill: white; display: block;">
                  <path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604 0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407 0 0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/>
                </svg>
              </span>
            </a>
          </div>
        </div>
        <h2 class="main-title"><span class="title-part title-part-1">NAEI Multi-Group</span> <span class="title-part title-part-2">Pollutant Viewer</span></h2>
      </div>
      <!-- Everything above the chart (dropdowns, buttons, group info, etc.) -->
    </div>
  <details class="my-4 bg-gray-50 border border-gray-300 rounded-2xl p-4 shadow-sm">
  <summary class="cursor-pointer text-lg font-semibold text-blue-700 hover:text-blue-900">
    ğŸ“˜ Quick Start Guide
  </summary>

  <div class="mt-3 space-y-3 text-gray-800 leading-relaxed">
    <p>
      <strong>Quick Start Guide:</strong> Select a <strong>pollutant</strong>, choose one or more <strong>groups</strong> to compare, set your <strong>year range</strong>, and view the interactive chart.
    </p>

 
    <h3 class="font-semibold text-blue-700">Essential Steps</h3>
    <p>
    <ol class="list-decimal list-inside space-y-2">
      <li><strong>Select Pollutant:</strong> Choose from PM2.5, NOx, COâ‚‚, etc.</li>
      <li><strong>Add Groups:</strong> Compare emission sources like "Road Transport" vs "Power Stations"</li>
      <li><strong>Set Years:</strong> Focus on specific time periods (1970-2023 available)</li>
      <li><strong>Interact:</strong> Hover over chart points, click legend items to show/hide lines</li>
      <li><strong>Export & Share:</strong> Download images, export data, or share via URL</li>
    </ol>
  </div>
    <p>
      Click <strong>"+ Add Group"</strong> to add a new group comparison (e.g., Road Transport, Power Stations, Domestic Combustion).<br>
      You can add up to <strong>10 groups</strong> to compare at once.<br>
  To remove a group, click <strong>"âˆ’ Remove Group"</strong> next to it (this appears when two or more groups are selected).
    </p>
    <p class="italic text-sm text-gray-600">
      ğŸ’¡ Tip: You can re-order the group boxes by clicking and dragging the â ¿ handle next to each group â€” the chart updates automatically.
    </p>

    <h3 class="font-semibold text-blue-700">3ï¸âƒ£ Set the Year Range</h3>
    <p>
      Use the <strong>Start Year</strong> and <strong>End Year</strong> dropdowns to focus on a particular time period.<br>
      The chart will automatically refresh to show data for the chosen range.
    </p>

    <h3 class="font-semibold text-blue-700">4ï¸âƒ£ View and Interact with the Chart</h3>
    <p>
      Once you've chosen your pollutant, groups, and years, the interactive line chart will appear.<br>
      <strong>Hover</strong> over any point on the chart to see the exact emission value for that year.<br>
      The <strong>Y-axis</strong> shows total emissions, including units (e.g., kilotonnes).<br>
      Each group is shown in a unique colour.
    </p>

    <h3 class="font-semibold text-blue-700">5ï¸âƒ£ Use the Legend to Toggle Lines</h3>
    <p>
      Above the chart, the legend lists all groups and their corresponding colours.<br>
      <strong>Click a group name</strong> in the legend to hide or show that group's line on the chart.<br>
      Faded items indicate hidden or unavailable data.<br>
      <em>(Groups labelled "(No data available)" are included for reference but contain no plotted values.)</em>
    </p>

    <h3 class="font-semibold text-blue-700">6ï¸âƒ£ Smooth or Straight Lines</h3>
    <p>
      Click the <strong>"ğŸš« Disable Smoothing"</strong> button to switch to straight (non-curved) lines.<br>
      Click again (the button will change to <strong>"âœ… Enable Smoothing"</strong>) to re-enable smooth, curved lines.
    </p>

<h3 class="font-semibold text-blue-700">7ï¸âƒ£ Download Options</h3>
<p>You can export both the chart and its underlying data for your own analysis or reporting.</p>

<p>
  <strong>ğŸ“Š Download Chart as PNG</strong><br>
  Click <strong>"â¬‡ï¸ Download Chart as PNG"</strong> to save the current chart as an image.<br>
  The exported image includes:
  <ul class="list-disc list-inside ml-4">
    <li>The chart itself</li>
    <li>Custom colour legend</li>
    <li>Pollutant name and emission unit</li>

  </ul>
</p>

<p>
  <strong>ğŸ“„ Download Data</strong><br>
  <strong>CSV:</strong> Click "ğŸ“„ Download Data â€“ CSV" for a spreadsheet-friendly text file.<br>
  <strong>Excel:</strong> Click "ğŸ“Š Download Data â€“ Excel" for a formatted Excel workbook.<br>
  Each file includes:
  <ul class="list-disc list-inside ml-4">
    <li>Pollutant name and emission unit in the first line</li>
    <li>Table with groups as rows and years as columns</li>
    <li>Footer row with download timestamp</li>
  </ul>
</p>

<h3 class="font-semibold text-blue-700">8ï¸âƒ£ Share Your Chart</h3>
<p>
  Click the <strong>Share</strong> button to copy a unique link or chart image.<br>
  You can easily share your current view with others, or paste the chart image into emails and documents.<br>
  The shared link will open the viewer with your selected pollutant, groups, and year range.
</p>

<h3 class="font-semibold text-blue-700">9ï¸âƒ£ View Group Details</h3>
<p>
  Use the <strong>"ğŸ“˜ See Group Info"</strong> section below the group selector to view details of how each group is built.<br>
  The table shows <strong>Source Names</strong> and <strong>Fuel Types</strong> from the NAEI data that have been combined to create each group.<br>
  If a group includes all sources or all fuel types, these will be shown as <em>"All Sources"</em> or <em>"All Fuel Types"</em>.
</p>

<h3 class="font-semibold text-blue-700">ğŸ”Ÿ Licensing and Attribution</h3>
<p>
  Â© Crown copyright (Defra & DESNZ) and available under the
  <strong>Open Government Licence (OGL)</strong>.<br>
  See links beneath the chart for full details.
</p>
</details>

      <div class="button-row">
        <label for="pollutantSelect">Pollutant:</label>
        <select id="pollutantSelect" name="pollutantSelect"><option value="">Select pollutant</option></select>
      </div>
      <div id="groupContainer"></div>
      <details class="my-4 bg-gray-50 border border-gray-300 rounded-2xl p-4 shadow-sm">
  <summary class="cursor-pointer text-lg font-semibold text-blue-700 hover:text-blue-900">
    ğŸ“˜ See Group Info
  </summary>

  <div id="group-info" class="mt-3 text-gray-800 leading-relaxed overflow-x-auto">
    <p>Loading group information...</p>
  </div>
</details>
    </div>

    <div id="mainContentBottom">
      <div class="year-download-row">
        <span class="year-pair">
          <label for="startYear">Start Year:</label>
          <select id="startYear" name="startYear"></select>
        </span>
        <span class="year-pair">
          <label for="endYear">End Year:</label>
          <select id="endYear" name="endYear"></select>
        </span>
  <button id="downloadBtn">â¬‡ï¸ Download Chart as PNG</button>
  <button id="downloadCleanBtn">â¬‡ï¸ Download Clean PNG</button>
        <button id="toggleSmoothBtn">ğŸš« Disable Smoothing</button>
        <button id="downloadCSVBtn">ğŸ“„ Download Data - CSV</button>
        <button id="downloadXLSXBtn">ğŸ“Š Download Data - Excel</button>
        <button id="shareBtn">ğŸ”— Share Chart</button>
      </div>

      <div class="chart-wrapper">
        <div id="chartTitle" aria-hidden="false"></div>
        <div id="customLegend" aria-hidden="true"></div>
        <div id="chart_div" role="img" aria-label="Pollutant time series chart"></div>
      </div>
    </div>
<footer>
  Â© Crown 2025 copyright Defra &amp; DESNZ via 
  <a href="https://naei.energysecurity.gov.uk" target="_blank" rel="noopener">naei.energysecurity.gov.uk</a> 
  licensed under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank" rel="noopener">Open Government Licence (OGL)</a>.
  <br>
  <strong>YouTube Channel:</strong> <a href="https://www.youtube.com/@ChronicIllnessChannel" target="_blank" rel="noopener">www.youtube.com/@ChronicIllnessChannel</a>
  <br>
  <span style="font-size: 0.8em; color: #666; margin-top: 4px; display: inline-block;">
    Version: v2.3 modular CIC-testdb â€¢ Build: 2025.10.29
  </span>
</footer>

  </div>

  <script src="supabase.js"></script>
  <script src="main.js"></script>
  <script src="export.js"></script>
</body>
</html>
